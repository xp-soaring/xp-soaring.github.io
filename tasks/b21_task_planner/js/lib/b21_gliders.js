var B21_WEATHER_DATA = {
    "Live": { "hash": ["0377926"] },
    "TT:MENU.WEATHERTYPE_9CLEAR_SKY": { "hash": ["4125525"] },
    "TT:MENU.WEATHERTYPE_1SUNNY": { "hash": ["9371002"] },
    "TT:MENU.WEATHERTYPE_3FEW_CLOUDS": { "hash": ["7809908"] },
    "TT:MENU.WEATHERTYPE_10BROKEN_CLOUDS": { "hash": ["5740321"] },
    "TT:MENU.WEATHERTYPE_4HIGH_LAYER": { "hash": ["2647963"] },
    "TT:MENU.WEATHERTYPE_2FULL_CLOUDS": { "hash": ["4462369"] },
    "TT:MENU.WEATHERTYPE_8RAIN": { "hash": ["0022391"] },
    "TT:MENU.WEATHERTYPE_SNOW": { "hash": ["7940708"] },
    "TT:MENU.WEATHERTYPE_5STORM": { "hash": ["9507412"] },
    "SSC2 - 1 Clear Sky N 10kt": { "hash": ["8129788"] },
    "SSC2 - 2 Clear Sky N 15kt": { "hash": ["1711368"] },
    "SSC2 - 3 Clear Sky NE 10kt": { "hash": ["1563457"] },
    "SSC2 - 4 Clear Sky NE 15kt": { "hash": ["7927762"] },
    "SSC2 - 5 Clear Sky E 10kt": { "hash": ["7781642"] },
    "SSC2 - 6 Clear Sky E 15kt": { "hash": ["4602921"] },
    "SSC2 - 7 Clear Sky SE 10kt": { "hash": ["3682285"] },
    "SSC2 - 8 Clear Sky SE 15kt": { "hash": ["1234384"] },
    "SSC2 - 9 Clear Sky S 10kt": { "hash": ["3623762"] },
    "SSC2 - 10 Clear Sky S 15kt": { "hash": ["0752691"] },
    "SSC2 - 11 Clear Sky SW 10kt": { "hash": ["6583356"] },
    "SSC2 - 12 Clear Sky SW 15kt": { "hash": ["6189310"] },
    "SSC2 - 13 Clear Sky W 10kt": { "hash": ["2268256"] },
    "SSC2 - 14 Clear Sky W 15kt": { "hash": ["9486839"] },
    "SSC2 - 15 Clear Sky NW 10kt": { "hash": ["4060306"] },
    "SSC2 - 16 Clear Sky NW 15kt": { "hash": ["7108334"] },
    "SSC2 - 17 Few Clouds 6k N 10kt": { "hash": ["6278943"] },
    "SSC2 - 18 Few Clouds 6k N 15kt": { "hash": ["4600911"] },
    "SSC2 - 19 Few Clouds 6k NE 10kt": { "hash": ["9878423"] },
    "SSC2 - 20 Few Clouds 6k NE 15kt": { "hash": ["3370806"] },
    "SSC2 - 21 Few Clouds 6k E 10kt": { "hash": ["3219693"] },
    "SSC2 - 22 Few Clouds 6k E 15kt": { "hash": ["4100012"] },
    "SSC2 - 23 Few Clouds 6k SE 10kt": { "hash": ["0116987"] },
    "SSC2 - 24 Few Clouds 6k SE 15kt": { "hash": ["2183107"] },
    "SSC2 - 25 Few Clouds 6k S 10kt": { "hash": ["3808405"] },
    "SSC2 - 26 Few Clouds 6k S 15kt": { "hash": ["9245131"] },
    "SSC2 - 27 Few Clouds 6k SW 10kt": { "hash": ["2040020"] },
    "SSC2 - 28 Few Clouds 6k SW 15kt": { "hash": ["9502903"] },
    "SSC2 - 29 Few Clouds 6k W 10kt": { "hash": ["0879353"] },
    "SSC2 - 30 Few Clouds 6k W 15kt": { "hash": ["5585317"] },
    "SSC2 - 31 Few Clouds 6k NW 10kt": { "hash": ["8152101"] },
    "SSC2 - 32 Few Clouds 6k NW 15kt": { "hash": ["8964483"] },
    "SSC2 - 33 Partly Cloudy 6k N 10kt": { "hash": ["1494964"] },
    "SSC2 - 34 Partly Cloudy 6k N 15kt": { "hash": ["9024152"] },
    "SSC2 - 35 Partly Cloudy 6k NE 10kt": { "hash": ["6201135"] },
    "SSC2 - 36 Partly Cloudy 6k NE 15kt": { "hash": ["9516964"] },
    "SSC2 - 37 Partly Cloudy 6k E 10kt": { "hash": ["1686398"] },
    "SSC2 - 38 Partly Cloudy 6k E 15kt": { "hash": ["9179074"] },
    "SSC2 - 39 Partly Cloudy 6k SE 10kt": { "hash": ["6234484"] },
    "SSC2 - 40 Partly Cloudy 6k SE 15kt": { "hash": ["4170020"] },
    "SSC2 - 41 Partly Cloudy 6k S 10kt": { "hash": ["5693894"] },
    "SSC2 - 42 Partly Cloudy 6k S 15kt": { "hash": ["1508127"] },
    "SSC2 - 43 Partly Cloudy 6k SW 10kt": { "hash": ["6487946"] },
    "SSC2 - 44 Partly Cloudy 6k SW 15kt": { "hash": ["0896751"] },
    "SSC2 - 45 Partly Cloudy 6k W 10kt": { "hash": ["7121522"] },
    "SSC2 - 46 Partly Cloudy 6k W 15kt": { "hash": ["1346466"] },
    "SSC2 - 47 Partly Cloudy 6k NW 10kt": { "hash": ["5599482"] },
    "SSC2 - 48 Partly Cloudy 6k NW 15kt": { "hash": ["3183254"] },
    "SSC2 - 49 Strong Clouds 10k N 10kt": { "hash": ["1653558"] },
    "SSC2 - 50 Strong Clouds 10k N 15kt": { "hash": ["5987053"] },
    "SSC2 - 51 Strong Clouds 10k NE 10kt": { "hash": ["3304488"] },
    "SSC2 - 52 Strong Clouds 10k NE 15kt": { "hash": ["4664702"] },
    "SSC2 - 53 Strong Clouds 10k E 10kt": { "hash": ["6212749"] },
    "SSC2 - 54 Strong Clouds 10k E 15kt": { "hash": ["3010730"] },
    "SSC2 - 55 Strong Clouds 10k SE 10kt": { "hash": ["9429093"] },
    "SSC2 - 56 Strong Clouds 10k SE 15kt": { "hash": ["9512267"] },
    "SSC2 - 57 Strong Clouds 10k S 10kt": { "hash": ["5568797"] },
    "SSC2 - 58 Strong Clouds 10k S 15kt": { "hash": ["1729948"] },
    "SSC2 - 59 Strong Clouds 10k SW 10kt": { "hash": ["7569195"] },
    "SSC2 - 60 Strong Clouds 10k SW 15kt": { "hash": ["7718227"] },
    "SSC2 - 61 Strong Clouds 10k W 10kt": { "hash": ["1768727"] },
    "SSC2 - 62 Strong Clouds 10k W 15kt": { "hash": ["8121259"] },
    "SSC2 - 63 Strong Clouds 10k NW 10kt": { "hash": ["2778310"] },
    "SSC2 - 64 Strong Clouds 10k NW 15kt": { "hash": ["1467475"] },
    "SSC2 - 65 Scattered Clouds 6k N 10kt": { "hash": ["2103337"] },
    "SSC2 - 66 Scattered Clouds 6k N 15kt": { "hash": ["8432154"] },
    "SSC2 - 67 Scattered Clouds 6k NE 10kt": { "hash": ["1278216"] },
    "SSC2 - 68 Scattered Clouds 6k NE 15kt": { "hash": ["0971319"] },
    "SSC2 - 69 Scattered Clouds 6k E 10kt": { "hash": ["1470048"] },
    "SSC2 - 70 Scattered Clouds 6k E 15kt": { "hash": ["0415753"] },
    "SSC2 - 71 Scattered Clouds 6k SE 10kt": { "hash": ["7482352"] },
    "SSC2 - 72 Scattered Clouds 6k SE 15kt": { "hash": ["1824377"] },
    "SSC2 - 73 Scattered Clouds 6k S 10kt": { "hash": ["6039870"] },
    "SSC2 - 74 Scattered Clouds 6k S 15kt": { "hash": ["5547223"] },
    "SSC2 - 75 Scattered Clouds 6k SW 10kt": { "hash": ["7052834"] },
    "SSC2 - 76 Scattered Clouds 6k SW 15kt": { "hash": ["4356317"] },
    "SSC2 - 77 Scattered Clouds 6k W 10kt": { "hash": ["1318123"] },
    "SSC2 - 78 Scattered Clouds 6k W 15kt": { "hash": ["1157480"] },
    "SSC2 - 79 Scattered Clouds 6k NW 10kt": { "hash": ["1557950"] },
    "SSC2 - 80 Scattered Clouds 6k NW 15kt": { "hash": ["2216511"] },
    "SSC2 - 81 Broken Clouds 6k N 10kt": { "hash": ["6548156"] },
    "SSC2 - 82 Broken Clouds 6k N 15kt": { "hash": ["6777409"] },
    "SSC2 - 83 Broken Clouds 6k NE 10kt": { "hash": ["9820137"] },
    "SSC2 - 84 Broken Clouds 6k NE 15kt": { "hash": ["7279524"] },
    "SSC2 - 85 Broken Clouds 6k E 10kt": { "hash": ["8362320"] },
    "SSC2 - 86 Broken Clouds 6k E 15kt": { "hash": ["4404806"] },
    "SSC2 - 87 Broken Clouds 6k SE 10kt": { "hash": ["7388228"] },
    "SSC2 - 88 Broken Clouds 6k SE 15kt": { "hash": ["4991127"] },
    "SSC2 - 89 Broken Clouds 6k S 10kt": { "hash": ["6714480"] },
    "SSC2 - 90 Broken Clouds 6k S 15kt": { "hash": ["6506039"] },
    "SSC2 - 91 Broken Clouds 6k SW 10kt": { "hash": ["6578263"] },
    "SSC2 - 92 Broken Clouds 6k SW 15kt": { "hash": ["5036250"] },
    "SSC2 - 93 Broken Clouds 6k W 10kt": { "hash": ["0791680"] },
    "SSC2 - 94 Broken Clouds 6k W 15kt": { "hash": ["5338574"] },
    "SSC2 - 95 Broken Clouds 6k NW 10kt": { "hash": ["8694521"] },
    "SSC2 - 96 Broken Clouds 6k NW 15kt": { "hash": ["7690677"] },
    "SSC2 - 97 Overcast 10k N 10kt": { "hash": ["2710656"] },
    "SSC2 - 98 Overcast 10k N 15kt": { "hash": ["8250562"] },
    "SSC2 - 99 Overcast 10k NE 10kt": { "hash": ["7163892"] },
    "SSC2 - 100 Overcast 10k NE 15kt": { "hash": ["8066385"] },
    "SSC2 - 101 Overcast 10k E 10kt": { "hash": ["3636150"] },
    "SSC2 - 102 Overcast 10k E 15kt": { "hash": ["1283574"] },
    "SSC2 - 103 Overcast 10k SE 10kt": { "hash": ["2327753"] },
    "SSC2 - 104 Overcast 10k SE 15kt": { "hash": ["0320588"] },
    "SSC2 - 105 Overcast 10k S 10kt": { "hash": ["3813281"] },
    "SSC2 - 106 Overcast 10k S 15kt": { "hash": ["2445563"] },
    "SSC2 - 107 Overcast 10k SW 10kt": { "hash": ["0130192"] },
    "SSC2 - 108 Overcast 10k SW 15kt": { "hash": ["6847146"] },
    "SSC2 - 109 Overcast 10k W 10kt": { "hash": ["9781145"] },
    "SSC2 - 110 Overcast 10k W 15kt": { "hash": ["8079252"] },
    "SSC2 - 111 Overcast 10k NW 10kt": { "hash": ["5279770"] },
    "SSC2 - 112 Overcast 10k NW 15kt": { "hash": ["0959824"] },
    "SSC2 - 113 Shifting Winds E to S (AGL)": { "hash": ["0390569"] },
    "SSC2 - 114 Shifting Winds E to S (AMSL)": { "hash": ["7258157"] },
    "SSC2 - 115 Shifting Winds N to E (AGL)": { "hash": ["6562732"] },
    "SSC2 - 116 Shifting Winds N to E (AMSL)": { "hash": ["1960553"] },
    "SSC2 - 117 Shifting Winds S to W (AGL)": { "hash": ["1153360"] },
    "SSC2 - 118 Shifting Winds S to W (AMSL)": { "hash": ["3580477"] },
    "SSC2 - 119 Shifting Winds W to N (AGL)": { "hash": ["9802295"] },
    "SSC2 - 120 Shifting Winds W to N (AMSL)": { "hash": ["6609585"] },
    "SSC2 - 121 Weak Thermals 6k": { "hash": ["1433260"] },
    "SSC2 - 122 Strong Thermals 6k": { "hash": ["8440274"] },
    "SSC3 074 Scattered Clouds 6k S 15kt": { "hash": ["5487891"] }
};

class B21_WEATHER {

    constructor() {
    }

    static name_to_hash(name) {
        console.log("B21_WEATHER.name_to_hash", name);
        if (B21_WEATHER_DATA[name] != null) {
            console.log("B21_WEATHER.name_to_hash", name, B21_WEATHER_DATA[name].hash[0]);
            return B21_WEATHER_DATA[name].hash[0];
        }
        return null;
    }

    static hash_to_name(hash) {
        console.log("B21_WEATHER.hash_to_name", hash);
        for ( let name in B21_WEATHER_DATA ) {
            for (let i = 0; i  <  B21_WEATHER_DATA[name].hash.length; i++) {
                let current_hash = B21_WEATHER_DATA[name].hash[i];
                if (current_hash == hash) {
                    console.log("B21_WEATHER.hash_to_name", hash, name);
                    return name;
                }
            }
        }
        return null;
    }

}

// B21_GLIDERS is used to provide 'standard' data for MSFS gliders, including normalising the glider_type
// Static class providec methods:
//
// find_glider_type(title_str) - returns glider_type or ""
// lookup(glider_type, key) - returns matching property in B21_GLIDERS_DATA

// Note TITLE_STRS should be LOWER CASE
var B21_GLIDERS_DATA = {
        "AS-33": {
            "TITLE_STRS": [ "as33", "as-33" ],
            "NB21_ACFG": [ "128D63EA22585AA47C381FC8",
                        "21735116C3548A2C1B61D69B",
                        "0C26C63E4D7FAD13BC406545"
            ],
            "NB21_FMCG": [ "1B0477A5B0103B6FBBB971A6"
            ],
            "MAX_WEIGHT_KG": 600,
            "VNE_TAS_KPH": 282
        },
        "ASW28": {
            "TITLE_STRS": [ "asw28", "asw-28" ],
            "MAX_WEIGHT_KG": 525,
            "VNE_TAS_KPH": 282
        },
        "JS3-18": {
            "TITLE_STRS": [ "js3-18" ],
            "NB21_ACFG": [ "753B807E002326612ACFA3A3", // V1 MSFS2020
                        "A51EB12DFB0552972D2A0A9E" // V2 MSFS2020+2024 v2.3.1
            ],
            "NB21_FMCG": [ "5395E12E6384EABE7B636C6F", // V1 MSFS2020
                         "DC1887B394EECA940D4EBE46", // V2 MSFS2020+2024 v2.3.1
                         "AD19DE857405A5640BE1848D"  // V3 v2.3.5
            ],
            "MAX_WEIGHT_KG": 600,
            "VNE_TAS_KPH": 292
        },
        "JS3-15": {
            "TITLE_STRS": [ "js3-15" ],
            "NB21_ACFG": [ "14E993B8CAA8350EF404F92C", // V1 MSFS2020
                        "A51D14335FA6C71DBF197FEB", // V2 MSFS2020
                        "963040A114AE421A90E34873" // V3 MSFS2020+2024 v2.3.1
            ],
            "NB21_FMCG": [ "350C66E7F8C644AC30537D6B", // V1 MSFS2020
                        "D58D5A058359CA594AB55499" // V2 MSFS2020+2024 v2.3.1
            ],
            "MAX_WEIGHT_KG": 525,
            "VNE_TAS_KPH": 292
        },
        "LS4": {
            "TITLE_STRS": [ "ls4" ],
            "NB21_ACFG": [ "A48A4EF4E2A9D96C843B4361",
                        '067AD89CAA95B9D8F2104D3C',
                        '46C5998C473790CDB000AAEC'  // V3 = MSFS2024 1.4.0
            ],
            "NB21_FMCG": [ "2CF10E6AEDEF85C111F41401",
                        '49297C175A997216905BE06D',
                        '2B2CAD92FD80DE5E3696CD9A', // V3 = MSFS2024 1.3.8
                        '9148FF5AA844B0AC1C8732BD'  // V4 = MSFS2024 1.4.0
            ],
            "MAX_WEIGHT_KG": 525,
            "VNE_TAS_KPH": 282
        },
        "DG808S": {
            "TITLE_STRS": [ "dg808" ],
            "NB21_ACFG": [ "0D933FB14EC7C1FC5E9C50FF",
                        '617D8901FFC57865966C1A42',
                        'AD2A2DAE9489BE555A943A0B',
                        '7E3FC6A03E66257D41360809'
            ],
            "NB21_FMCG": [ "612014C72D2B9816C06CB778",
                        '8BDD0288671E70B14A3F9944',
                        'D44F8E99540D500341A45DE0'
            ],
            "MAX_WEIGHT_KG": 600,
            "VNE_TAS_KPH": 282
        },
        "AS7": {
            "TITLE_STRS": [ "as7", " k7", "k7 " ],
            "NB21_ACFG": [ "0CF71B19CD5135728AE56972",
                        "1179917BE9A2FBC690C157C5"
            ],
            "NB21_FMCG": [ "51EF38E151AAAFAA8D56AB13", // V1 MSFS2020
                        "ECCE3FB85D18431EE75840DC" // V2 MSFS2020 + 2024
            ],
            "MAX_WEIGHT_KG": 484.5,
            "VNE_TAS_KPH": 209
        },
        "D2C": {
            "TITLE_STRS": [ "d2c", "discus" ],
            "NB21_ACFG": [ "3E0C44899BFAE022333DD031"
            ],
            "NB21_FMCG": [ "9423DEDB0380C1A9D482080A",
                        'F5F9FFE0AC73623470D0D39A',
                        'F310F9D3DEEA4B5B90CBD29B', // 2.0.8
                        'F09A18F3A4B0A1DD95A8308E', // 2.1.0
                        '0D3E5A401F352EE566C53109' // engine?
            ],
            "MAX_WEIGHT_KG": 565,
            "VNE_TAS_KPH": 292
        },
        "Asobo_LS8": {
            "TITLE_STRS": [ "ls8", "mxs" ],
            "NB21_ACFG": [ "3B42B4378BE570DF675D2363F",
                        '913A154DD71DB358BC981B3A'
            ],
            "NB21_FMCG": [ "1101DA2C71E9B25D1363D936",
                        'E9CC0A261EFB7FB1449287ED'
            ],
            "MAX_WEIGHT_KG": 575,
            "VNE_TAS_KPH": 292
        },
        "DGF": {
            "TITLE_STRS": [ "dgf", "dg1001" ],
            "NB21_ACFG": [ "CA728979D50E2D4E1B413891"
            ],
            "NB21_FMCG": [ "AEDA50561766217B28C244B7"
            ],
            "MAX_WEIGHT_KG": 750,
            "VNE_TAS_KPH": 282
        },
        "T31": {
            "TITLE_STRS": [ "t31" ],
            "MAX_WEIGHT_KG": 376,
            "VNE_TAS_KPH": 292
        },
        "SZD30": {
            "TITLE_STRS": [ "szd30", "szd-30", "pirat", "yanosik" ],
            "NB21_ACFG": [ '5A6A99C67F3A928DC2954647', // 1.0
                        'B586C65483CE078AD2254383' // B21 1.1.1
            ],
            "NB21_FMCG": [ '5FA5FE53894E11284FD6FEF2', // 1.0
                        'FB56C6A897F6088BA3446CC9' // EPPR 1.1
            ],
            "MAX_WEIGHT_KG": 370,
            "VNE_TAS_KPH": 204
        },
        "S12G": {
            "TITLE_STRS": ["stemme", "s12g"],
            "MAX_WEIGHT_KG": 900,
            "VNE_TAS_KPH": 282
        },
        "ASK21": {
            "TITLE_STRS": ["ask21", "ask-21", "k21"],
            "MAX_WEIGHT_KG": 600,
            "VNE_TAS_KPH": 292,
            "NB21_ACFG": [ '0D80744D55C63B52D3858C4B', // 1.0
                        'CFBF0C2E620475F9DA335EDB', // 1.0 aero
                        '4752A186F3309FCDA2C89F70', // 1.05
                        '1DD715876D3E401A6CF62849',  // 1.05 aero
                        'F3AAD1FD4395E298FD9AC5AE' // 1.3.0
            ],
            "NB21_FMCG": [ 'CD2F043264848184C4B6D089', // 1.0 base & aero
                        '83B3D349102683CAAF23034A', // 1.05 base & aero
                        '548E2BA6550F987325F6D92D', // 1.2.0
                        '13D7A87B12889FDFE376F49E' // 1.3.0
            ]
        },
        "Taurus": {
            "TITLE_STRS": ["taurus", "pipistrel"],
            "MAX_WEIGHT_KG": 550,
            "VNE_TAS_KPH": 282
        }
    }; // end glider_data

class B21_GLIDERS {

    constructor() {
    }


    // Only used inside B21_GLIDERS
    static lookup(glider_type, key) {
        let id = glider_type;
        if (B21_GLIDERS[id] == null) {
            // That glider id not found, so search using title strings
            id = B21_GLIDERS.find_glider_type(id);
        }
        return B21_GLIDERS_DATA[id][key];
    }

    static check_key(glider_type, event_key, chksum) {
        let chksums = B21_GLIDERS.lookup(glider_type, "NB21_"+event_key);
        if (chksums == null) {
            return null;
        }
        for (let i=0;i<chksums.length;i++) {
            if (chksums[i] == chksum) {
                return i;
            }
        }
        return null;
    }

    // Here's our plane-mapping code because MSFS does it so badly
    static find_glider_type(title_str) {

        let title_str_lc = title_str.toLowerCase();

        for (const [glider_type, glider_entry] of Object.entries(B21_GLIDERS_DATA)) {

            for (let i=0; i<glider_entry.TITLE_STRS.length; i++) {
                if (title_str_lc.includes(glider_entry.TITLE_STRS[i])) {
                    return glider_type;
                }
            }
        }

        return "";
    }

    static get_glider_data(glider_type) {
        console.log(`B21_GLIDERS.get_glider_type '${glider_type}'`);
        if (B21_GLIDERS_DATA[glider_type] != null) {
            console.log(`B21_GLIDERS.get_glider_type '${glider_type} immediate success'`);
            return B21_GLIDERS_DATA[glider_type];
        }
        let gtype = B21_GLIDERS.find_glider_type(glider_type);
        if (gtype == "") {
            console.log(`B21_GLIDERS.get_glider_type '${glider_type}' find_glider_type failed`);
            return null;
        }
        console.log(`B21_GLIDERS.get_glider_type '${gtype}' returning glider_data `);
        return B21_GLIDERS_DATA[gtype];
    }
} // end class B21_GLIDERS
